name: Notify QA Team

on:
  workflow_dispatch:
    inputs:
      build_version:
        description: 'Build version/tag to deploy'
        required: false
        default: 'latest'
        type: string
      build_notes:
        description: 'Notes about this build (features, fixes, etc.)'
        required: false
        type: string

permissions:
  issues: write
  contents: read

jobs:
  notify-qa:
    runs-on: ubuntu-latest
    steps:
      - name: Create QA Notification Issue
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ðŸ§ª Build Ready for QA: ${{ inputs.build_version }}`,
              body: `## New Build Ready for QA Testing

            **Build Details:**
            - Version: \`${{ inputs.build_version }}\`
            - Commit: \`${{ github.sha }}\`
            - Notified by: @${{ github.actor }}
            - Date: ${new Date().toISOString()}

            **Notes:**
            ${{ inputs.build_notes || 'No additional notes provided.' }}

            ---

            ## âœ… How to Deploy to QA

            **Comment \`deploy\` or \`approved\` on this issue to trigger QA deployment.**

            The deployment will start automatically and this issue will close.

            ---

            /cc @alokknight
            `,
              labels: ['qa-ready']
            });

      - name: Summary
        run: |
          echo "âœ… QA team has been notified!"
          echo "Build version: ${{ inputs.build_version }}"
          echo "QA can comment 'deploy' on the issue to trigger deployment"
